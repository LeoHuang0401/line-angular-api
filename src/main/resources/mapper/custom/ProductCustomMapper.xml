<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tw.com.imsoft.dao.mapper.custom.ProductCustomMapper">
  <resultMap id="BaseResultMap" type="tw.com.imsoft.dao.model.Product">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 06 15:47:11 CST 2023.
    -->
    <id column="PRODUCT_ID" jdbcType="NUMERIC" property="productId" />
    <result column="PRODUCT_NAME" jdbcType="VARCHAR" property="productName" />
    <result column="STORE_ID" jdbcType="NUMERIC" property="storeId" />
    <result column="PRODUCT_DESC" jdbcType="VARCHAR" property="productDesc" />
    <result column="PRODUCT_IMG" jdbcType="VARCHAR" property="productImg" />
    <result column="PRODUCT_CATEGORY_ID" jdbcType="VARCHAR" property="productCategoryId" />
  </resultMap>
  <resultMap id="OrderDetail" type="tw.com.imsoft.domain.vo.order.OrderProductDetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 06 15:47:11 CST 2023.
    -->
    <id column="PRODUCT_ID" jdbcType="NUMERIC" property="productId" />
    <result column="PRODUCT_NAME" jdbcType="VARCHAR" property="productName" />
    <result column="PRODUCT_DESC" jdbcType="VARCHAR" property="productDesc" />
    <result column="PRODUCT_IMG" jdbcType="VARCHAR" property="productImg" />
    <result column="PRODUCT_SIZE_NAME" jdbcType="VARCHAR" property="productSizeName" />
    <result column="PRICE" jdbcType="VARCHAR" property="price" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 15 15:35:45 CST 2023.
    -->
    PRODUCT_ID, PRODUCT_NAME, STORE_ID, PRODUCT_DESC, PRODUCT_IMG, PRODUCT_CATEGORY_ID
  </sql>
  <select id="selectProductData" resultType="HashMap">
  	SELECT 	a.PRODUCT_ID 
  			,a.PRODUCT_NAME 
  			,a.PRODUCT_CATEGORY_ID
  			,a.PRODUCT_DESC 
  			,a.PRODUCT_IMG
  			,b.PRODUCT_CATEGORY_NAME 
  			,c.product_size_name
  			,c.price
	FROM PRODUCT a 
	LEFT JOIN PRODUCT_CATEGORY b ON a.PRODUCT_CATEGORY_ID = b.PRODUCT_CATEGORY_ID 
	LEFT JOIN
		(SELECT 
			  PRODUCT_ID 
			  ,LISTAGG(PRODUCT_SIZE_NAME,',') AS PRODUCT_SIZE_NAME 
			  ,LISTAGG(PRICE,',') AS PRICE 
	FROM  PRODUCT_SIZE   
	GROUP BY PRODUCT_ID  
	ORDER BY PRODUCT_ID ASC)c 
	ON a.PRODUCT_ID = c.product_id
  </select>
  
  <select id="selectProductDetail" resultMap="OrderDetail">
  SELECT 	a.PRODUCT_ID 
  			,a.PRODUCT_NAME
  			,a.PRODUCT_DESC 
  			,a.PRODUCT_IMG
  			,c.product_size_name
  			,c.price
	FROM PRODUCT a 
	LEFT JOIN PRODUCT_CATEGORY b ON a.PRODUCT_CATEGORY_ID = b.PRODUCT_CATEGORY_ID 
	LEFT JOIN
		(SELECT 
			  PRODUCT_ID 
			  ,LISTAGG(PRODUCT_SIZE_NAME,',') AS PRODUCT_SIZE_NAME 
			  ,LISTAGG(PRICE,',') AS PRICE 
	FROM  PRODUCT_SIZE   
	GROUP BY PRODUCT_ID  
	ORDER BY PRODUCT_ID ASC)c 
	ON a.PRODUCT_ID = c.product_id
  WHERE a.PRODUCT_ID  = #{productId,jdbcType=VARCHAR}
  </select>
  
</mapper>